# MP3 Test Vectors

## Recommended

### ID3v2.4 and ID3v2.3 TXXX Frames

This is the recommended format as specified in the
[Hydrogenaudio ReplayGain specification](http://wiki.hydrogenaud.io/index.php?title=ReplayGain_specification#ID3v2) 
and the
[Hydrogenaudio Replaygain 2.0 specification](http://wiki.hydrogenaud.io/index.php?title=ReplayGain_2.0_specification#ID3v2).
It matches the tag format generated by [Foobar2000](https://foobar2000.org/)
and most modern ReplayGain scanning tools.

#### Basic functionality

- `id3v24-txxx-track-only.mp3` and `id3v23-txxx-track-only.mp3`

  Files that have only track gain and peak present. They should play at the
  reference level regardless of whether the player is in track or album mode.
  If no gain is applied, they will play back too quietly.

  track gain: 12 dB, track peak: 0.251189, album gain & album peak not set.

- `id3v24-txxx-track.mp3` and `id3v23-txxx-track.mp3`

  Files for testing the application's track mode setting. These should play at
  the reference level if the player is in track mode. They will play too
  quietly if the album gain is used, and too loud if no gain is applied.

  track gain: -12 dB, track peak: 1.0, album gain: -24 dB, album peak: 1.0

- `id3v24-txxx-album.mp3` and `id3v23-txxx-album.mp3`

  Files for testing the application's album mode setting. These should play at
  the reference level if the player is in album mode. They will play too
  quietly if the track gain is used, and too loud if no gain is applied.

  track gain: -24 dB, track peak: 1.0, album gain: -12 dB, album peak: 1.0

#### Clipping prevention

These files are designed to verify the behaviour of the players clipping
prevention support, which should be a configurable option that allows selecting
between lowering the gain based on stored peak value ReplayGain tags, or
keeping the desired level and applying an audio limiter or compression filter
to reduce audible artifacts.

- `id3v23-txxx-track-nopeak.mp3` and `id3v23-txxx-album-nopeak.mp3`
  
  These test files are designed to verify that the player allows raising the
  gain past the maximum headroom indicated when the player is configured not
  to reduce gain on tracks which might clip.

  The first file tests track mode; the second covers album mode. In both cases,
  the files will play too quietly if peak limiting is applied, and at the
  reference level if the peak values are correctly ignored.

  `track-nopeak`: track gain: 12 dB, track peak: 1.0,
                  album gain: 0 dB, album peak: 3.981072

  `album-nopeak`: track gain: 24 dB, track peak: 0.063096, 
                  album gain: 12 dB, album peak: 1.0


- `id3v23-txxx-peak.mp3`

  This test file verifies that the player will reduce the playback gain based
  on the stored peak value when the gain reduction feature is enabled.

  The same test file is used for both album and track mode. In track mode, the
  file should play back at the reference level. In album mode, the file should
  play back quieter than the reference level (match the `reference-12` file).

  If the gains are switched (track mode is quiet, album mode is reference),
  then the wrong peak values are being used. If the playback is loud, then
  the peak values are not being applied.

  track gain: 24 dB, track peak: 0.251189,
  album gain: 24 dB, album peak: 0.063096

#### Text encoding

ID3v2 tags can use multiple text encodings. These tests simply verify that the
tags are read correctly. All files contain track gain values only. They will
play back at the reference level if the tags are read, and quietly otherwise.

- `id3v23-txxx-latin1.mp3`

  Verify that tags are supported in the legacy 8-bit encoding format.

- `id3v24-txxx-utf8.mp3`

  Verify that tags are supported in the (v2.4-only) multibyte UTF-8 encoding.

#### ReplayGain tag formatting

The modern ReplayGain tag spec gives a specific format to use for the tags,
but tag-writing applications have significant variations in the formats
they actually use. These tests verify the robustness of the tag parser.

- `id3v23-txxx-case.mp3`

  Verify that the `REPLAYGAIN_*_GAIN` tags are matched case-insensitively.

  In track mode this file will play back at the reference level. In album
  mode it will play back at 12 dB quieter than the reference level. If the
  tags aren't read correctly it will play back 12 dB louder than the
  reference level.

  track gain: -12 dB, track peak: 1.0, album gain: -24 dB, album peak: 1.0

## Optional

### APEv2 Tags

Some applications, such as the `mp3gain` command line tool (by default, at
least), store the calculated gain information in an APEv2 tag. The format used
is the same as used in VorbisComment-style tags.

#### Basic functionality

- `apev2-track-only.mp3`

  File that has only APEv2 format track gain and peak present. It should play
  at the reference level regardless of whether the player is in track or album
  mode. If the gain is not applied, the playback will be too quiet.

#### Tag conflicts

The APEv2 tags can be present on an MP3 file in addition to ID3 tags of
various types. If both are present with conflicting values, the recommended
format should be preferred.

- `apev2-track-prefer-id3-txxx.mp3`

  A file with conflicting APEv2 and ID3v2 TXXX ReplayGain tags. Use in track
  gain mode. If the preferred ID3 TXXX tag is used, the file will play back at
  the reference level. Instead, if the APEv2 tag is used, the file will play
  back too quietly. In album gain mode, or if neither tag is used, the file
  will play back too loud.
